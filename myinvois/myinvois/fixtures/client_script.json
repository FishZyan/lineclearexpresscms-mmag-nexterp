[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2025-02-13 09:39:12.053413",
  "module": "myinvois",
  "name": "Consolidate",
  "script": "frappe.listview_settings['Sales Invoice'] = {\r\n    onload: function (listview) {\r\n        listview.page.add_button(__('Custom Action'), function () {\r\n            frappe.msgprint(__('Custom Action Button Clicked!'));\r\n        }, 'Custom Actions');  // This groups it under \"Custom Actions\"\r\n    }\r\n};",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2025-03-04 11:19:05.248107",
  "module": "myinvois",
  "name": "Individual Send",
  "script": "frappe.listview_settings['Sales Invoice'] = {\r\n    onload: function(listview) {\r\n        listview.page.add_action_item(__('Submit E-invoices'), function() {\r\n            // Get the selected documents\r\n            let selected_docs = listview.get_checked_items();\r\n\r\n            // Check if any documents are selected\r\n            if (selected_docs.length === 0) {\r\n                frappe.msgprint(__('Please select at least one document.'));\r\n                return;\r\n            }\r\n            frappe.msgprint(__('Sending E-invoice...'));\r\n            // Call the server-side method\r\n            frappe.call({\r\n                method: 'myinvois.myinvois.consolidate.send_lhdn_invois', // Correct method path\r\n                args: {\r\n                    invoices: selected_docs.map(doc => doc.name) // Pass selected invoice names\r\n                },\r\n                callback: function(response) {\r\n                    console.log(response)\r\n                    if (response.message && response.message.status === \"queued\") {\r\n                        let job_id = response.message.job_id;\r\n                        check_job_status(job_id, selected_docs.map(doc => doc.name), listview);\r\n                    } else {  \r\n                        frappe.msgprint(__('Failed to start process.'));\r\n                    }\r\n                },\r\n                error: function(error) {\r\n                    frappe.msgprint(__('An error occurred: {0}', [error.message]));\r\n                }\r\n            });\r\n        });\r\n        \r\n        function check_job_status(job_id, invoices, listview) {\r\n            let interval = setInterval(function() {\r\n                frappe.call({\r\n                    method: \"myinvois.myinvois.consolidate.check_invoice_job_status\",\r\n                    args: { job_id: job_id, invoices: invoices},\r\n                    callback: function(response) {\r\n                        console.log(response)\r\n                        clearInterval(interval);\r\n                        let data = JSON.parse(response.message);\r\n                        let successInvoices = data.success;\r\n                        let pendingInvoices = data.pending;\r\n                        let failedInvoices = data.failed;\r\n                        \r\n                        let message = \"\";\r\n                        if (successInvoices.length > 0) {\r\n                            message += \"<div>Successful Invoices:</div>\";\r\n                            successInvoices.forEach(invoice => {\r\n                                message += `\r\n                                    <div style=\"display: flex; align-items: center;\">\r\n                                        <span style=\"height: 10px; width: 10px; background-color: green; border-radius: 50%; display: inline-block; margin-right: 5px;\"></span>\r\n                                        <a href=\"/app/sales-invoice/${invoice}\" target=\"_blank\">${invoice}</a>\r\n                                    </div>\r\n                                `;\r\n                            });\r\n                        }\r\n                        \r\n                        if (pendingInvoices.length > 0) {\r\n                            message += \"<div>Pending Invoices:</div>\";\r\n                            pendingInvoices.forEach(invoice => {\r\n                                message += `\r\n                                    <div style=\"display: flex; align-items: center;\">\r\n                                        <span style=\"height: 10px; width: 10px; background-color: yellow; border-radius: 50%; display: inline-block; margin-right: 5px;\"></span>\r\n                                        <a href=\"/app/sales-invoice/${invoice}\" target=\"_blank\">${invoice}</a>\r\n                                    </div>\r\n                                `;\r\n                            });\r\n                        }\r\n                        \r\n                        if (failedInvoices.length > 0) {\r\n                            message += \"<div>Failed Invoices:</div>\";\r\n                            failedInvoices.forEach(invoice => {\r\n                                message += `\r\n                                    <div style=\"display: flex; align-items: center;\">\r\n                                        <span style=\"height: 10px; width: 10px; background-color: red; border-radius: 50%; display: inline-block; margin-right: 5px;\"></span>\r\n                                        <a href=\"/app/sales-invoice/${invoice}\" target=\"_blank\">${invoice}</a>\r\n                                    </div>\r\n                                `;\r\n                            });\r\n                        }\r\n                        frappe.msgprint(message);\r\n                    }\r\n                });\r\n            }, 10000); // Poll every 10 seconds\r\n        }\r\n    }\r\n};",
  "view": "List"
 }
]